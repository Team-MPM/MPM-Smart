<!DOCTYPE html><html><head><meta charset="UTF-8"><script src="https://cdn.jsdelivr.net/npm/prismjs/prism.js"></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs/components/prism-bash.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs/prism.js"></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs/components/prism-csharp.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs/prism.js"></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs/components/prism-json.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs/prism.js"></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs/components/prism-markup.min.js"></script><style>
        .article {
            position: relative;
            padding-bottom: 24px;
        }
        

        .bordered-element-rounded {
            border: 1px solid #c4c4c4;
            border-radius: 7px;
            overflow: hidden;
        }
        

        .center {
            display: block;
            margin-left: auto;
            margin-right: auto;
        }
        

        .center-text {
            text-align: center;
        }
        

        .code-block {
            overflow: hidden;
            position: relative;
            padding: 0;
            border-radius: 8px;
            font-variant-ligatures: none;
            background-color: rgba(25, 25, 28, .05);
            word-break: break-all;
        }
        

        .container {
            max-width: 100%;
            overflow: hidden;
            page-break-inside: avoid;
            display: block;
        }
        

        .control {
            color: #19191c;
            font-size: 16px;
            font-weight: 670;
        }
        

        .detached {
            margin-block-start: 0;
            margin-block-end: 0;
            margin-bottom: 8px;
        }
        

        .filepath {
            color: #19191c;
            font-size: 15px;
            font-weight: 700;
            line-height: inherit;
        }
        

        .flex {
            display: flex;
        }
        

        .image {
            max-width: 100%;
            max-height: 90vh;
            height: auto;
        }
        

        .image-container {
            max-width: 100vw;
        }
        

        .image-size {
            height: auto;
        }
        

        .inline-code {
            border-radius: 4px;
            display: inline;
            padding: 2px 1px;
            font-family: JetBrains Sans,monospace;
            background: #e6e6e6;
        }
        

        .list {
            list-style-type: disc;
            padding-left: 0;
            margin-left: 15px;
        }
        

        .list-item {
            margin-top: 6px;
            margin-bottom: 6px;
            margin-left: 4px;
        }
        

        .main-title {
            padding-bottom: 24px;
            margin-top: 0;
            font-size: 40px;
            margin-block-start: 0;
            margin-block-end: 0;
        }
        

        .prism {
            page-break-inside: avoid;
        }
        
        /* PrismJS 1.29.0
https://prismjs.com/download.html#themes=prism&languages=markup+css+clike+javascript+abap+abnf+actionscript+ada+agda+al+antlr4+apacheconf+apex+apl+applescript+aql+arduino+arff+armasm+arturo+asciidoc+aspnet+asm6502+asmatmel+autohotkey+autoit+avisynth+avro-idl+awk+bash+basic+batch+bbcode+bbj+bicep+birb+bison+bnf+bqn+brainfuck+brightscript+bro+bsl+c+csharp+cpp+cfscript+chaiscript+cil+cilkc+cilkcpp+clojure+cmake+cobol+coffeescript+concurnas+csp+cooklang+coq+crystal+css-extras+csv+cue+cypher+d+dart+dataweave+dax+dhall+diff+django+dns-zone-file+docker+dot+ebnf+editorconfig+eiffel+ejs+elixir+elm+etlua+erb+erlang+excel-formula+fsharp+factor+false+firestore-security-rules+flow+fortran+ftl+gml+gap+gcode+gdscript+gedcom+gettext+gherkin+git+glsl+gn+linker-script+go+go-module+gradle+graphql+groovy+haml+handlebars+haskell+haxe+hcl+hlsl+hoon+http+hpkp+hsts+ichigojam+icon+icu-message-format+idris+ignore+inform7+ini+io+j+java+javadoc+javadoclike+javastacktrace+jexl+jolie+jq+jsdoc+js-extras+json+json5+jsonp+jsstacktrace+js-templates+julia+keepalived+keyman+kotlin+kumir+kusto+latex+latte+less+lilypond+liquid+lisp+livescript+llvm+log+lolcode+lua+magma+makefile+markdown+markup-templating+mata+matlab+maxscript+mel+mermaid+metafont+mizar+mongodb+monkey+moonscript+n1ql+n4js+nand2tetris-hdl+naniscript+nasm+neon+nevod+nginx+nim+nix+nsis+objectivec+ocaml+odin+opencl+openqasm+oz+parigp+parser+pascal+pascaligo+psl+pcaxis+peoplecode+perl+php+phpdoc+php-extras+plant-uml+plsql+powerquery+powershell+processing+prolog+promql+properties+protobuf+pug+puppet+pure+purebasic+purescript+python+qsharp+q+qml+qore+r+racket+cshtml+jsx+tsx+reason+regex+rego+renpy+rescript+rest+rip+roboconf+robotframework+ruby+rust+sas+sass+scss+scala+scheme+shell-session+smali+smalltalk+smarty+sml+solidity+solution-file+soy+sparql+splunk-spl+sqf+sql+squirrel+stan+stata+iecst+stylus+supercollider+swift+systemd+t4-templating+t4-cs+t4-vb+tap+tcl+tt2+textile+toml+tremor+turtle+twig+typescript+typoscript+unrealscript+uorazor+uri+v+vala+vbnet+velocity+verilog+vhdl+vim+visual-basic+warpscript+wasm+web-idl+wgsl+wiki+wolfram+wren+xeora+xml-doc+xojo+xquery+yaml+yang+zig&plugins=highlight-keywords */
code[class*=language-],pre[class*=language-]{color:#000;background:0 0;text-shadow:0 1px #fff;font-family:Consolas,Monaco,'Andale Mono','Ubuntu Mono',monospace;font-size:1em;text-align:left;white-space:pre-wrap;word-spacing:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none}code[class*=language-] ::-moz-selection,code[class*=language-]::-moz-selection,pre[class*=language-] ::-moz-selection,pre[class*=language-]::-moz-selection{text-shadow:none;background:#b3d4fc}code[class*=language-] ::selection,code[class*=language-]::selection,pre[class*=language-] ::selection,pre[class*=language-]::selection{text-shadow:none;background:#b3d4fc}@media print{code[class*=language-],pre[class*=language-]{text-shadow:none}}pre[class*=language-]{padding:16px;margin:0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#f5f2f0}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#708090}.token.punctuation{color:#999}.token.namespace{opacity:.7}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:#905}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#690}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url{color:#9a6e3a;background:hsla(0,0%,100%,.5)}.token.atrule,.token.attr-value,.token.keyword{color:#07a}.token.class-name,.token.function{color:#dd4a68}.token.important,.token.regex,.token.variable{color:#e90}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}

        

        .prompt {
            flex-direction: row;
            letter-spacing: .0015em;
            font-size: 16px;
            font-weight: 400;
            line-height: 24px;
            margin-left: 0;
            margin-right: 0;
        }
        

        .prompt-content {
            padding: 15px;
            overflow: hidden;
            flex: 1 1 auto;
        }
        

        .prompt-content-p p {
            margin-block-start: 0;
            margin-block-end: 0;
        }
        

        .prompt-icon {
            flex: 0 0 auto;
            margin-left: 15px;
            margin-top: 15px;
            fill: currentcolor;
            width: 24px;
            height: 24px;
        }
        

        .prompt-title {
            font-size: 17px;
            font-weight: 600;
            line-height: 24px;
            margin-bottom: 5px;
            color: inherit;
        }
        

        .tip {
            background-color: rgba(25, 25, 28, .05);
        }
        

        .topic {
            page-break-before: always;
        }
        </style><title>pdfSourceIN</title></head><body><div><section class="topic"><div><article class="article"><h1 class="main-title">Table of Contents</h1><div class="entry"><div class="toc-link-container"><a class="toc-link" href="#2255103">Home</a></div><div class="page">2</div></div><div class="entry"><div class="toc-link-container"><a class="toc-link" href="#-1838751110">User Guide</a></div><div class="page">3</div></div><div class="entry"><div class="toc-link-container"><a class="toc-link" href="#-472489356">Initial Setup</a></div><div class="page">4</div></div><div class="entry"><div class="toc-link-container"><a class="toc-link" href="#184864645">User Management</a></div><div class="page">5</div></div><div class="entry"><div class="toc-link-container"><a class="toc-link" href="#-440975196">Devices Integration</a></div><div class="page">6</div></div><div class="entry"><div class="toc-link-container"><a class="toc-link" href="#-1443814627">Plugin Management</a></div><div class="page">7</div></div><div class="entry"><div class="toc-link-container"><a class="toc-link" href="#-2026317385">Developer Documentation</a></div><div class="page">8</div></div><div class="entry"><div class="toc-link-container"><a class="toc-link" href="#1003994483">Architecture</a></div><div class="page">10</div></div><div class="entry"><div class="toc-link-container"><a class="toc-link" href="#1463711460">Build Instructions</a></div><div class="page">12</div></div><div class="entry"><div class="toc-link-container"><a class="toc-link" href="#1189023616">Plugins</a></div><div class="page">13</div></div><div class="entry"><div class="toc-link-container"><a class="toc-link" href="#-877782410">Creating your first Plugin</a></div><div class="page">14</div></div><div class="entry"><div class="toc-link-container"><a class="toc-link" href="#1005571011">Developing plugins locally</a></div><div class="page">17</div></div><div class="entry"><div class="toc-link-container"><a class="toc-link" href="#-2092318995">Managing Plugin Services</a></div><div class="page">18</div></div></article></div></section><section class="topic"><div><article class="article"><h1 class="main-title" id="2255103">Home</h1><section><h2 id="2255103#the-team" data-toc="the-team#Home.topic-the-team">The Team</h2><ul class="list" id="2255103#-1r1no4_5" start="1"><li class="list-item" id="2255103#-1r1no4_6"><p>Plazinski Olaf (Team Lead)</p></li><li class="list-item" id="2255103#-1r1no4_7"><p>Martin Gabriel (Tech)</p></li><li class="list-item" id="2255103#-1r1no4_8"><p>Mayer Julian (UI)</p></li><li class="list-item" id="2255103#-1r1no4_9"><p>Toifl Jacob (UI)</p></li></ul></section><section><h2 id="2255103#the-idea" data-toc="the-idea#Home.topic-the-idea">The idea</h2><p id="2255103#-1r1no4_10">Creating a fully wireless smart-home/<span id="2255103#-1r1no4_11">IOT</span> automation system with a central management controller. We implement an open standard built on plugins and an extensible architecture. The entire Project is fully open source, and contributions from the community are highly welcome. We collect metrics and telemetry from multiple sources and display them in custom configurable dashboards. We also plan to support actor devices that can be controlled via the dashboard in real time or automatically controlled via dynamic workflows.</p></section></article></div></section><section class="topic"><div><article class="article"><h1 class="main-title" id="-1838751110">User Guide</h1></article></div></section><section class="topic"><div><article class="article"><h1 class="main-title" id="-472489356">Initial Setup</h1></article></div></section><section class="topic"><div><article class="article"><h1 class="main-title" id="184864645">User Management</h1></article></div></section><section class="topic"><div><article class="article"><h1 class="main-title" id="-440975196">Devices Integration</h1></article></div></section><section class="topic"><div><article class="article"><h1 class="main-title" id="-1443814627">Plugin Management</h1></article></div></section><section class="topic"><div><article class="article"><h1 class="main-title" id="-2026317385">Developer Documentation</h1><p id="-2026317385#-v7j3hi_3">This document is intended for developers who want to contribute to the Writerside project. It provides an overview of the project's architecture, the technologies used, and the development process.</p><section><h2 id="-2026317385#required-tools" data-toc="required-tools#Developer-Documentation.md-required-tools">Required Tools</h2><ul class="list" id="-2026317385#-v7j3hi_8" start="1"><li class="list-item" id="-2026317385#-v7j3hi_9"><p>.NET 9 SDK</p></li><li class="list-item" id="-2026317385#-v7j3hi_10"><p>Dotnet ef tools (For Entity Framework Core)</p></li><li class="list-item" id="-2026317385#-v7j3hi_11"><p>Platform IO (For ESP32 development)</p></li><li class="list-item" id="-2026317385#-v7j3hi_12"><p>JetBrains Writerside (Documentation)</p></li><li class="list-item" id="-2026317385#-v7j3hi_13"><p>Docker</p></li><li class="list-item" id="-2026317385#-v7j3hi_14"><p>A modern web browser</p></li><li class="list-item" id="-2026317385#-v7j3hi_15"><p>Git</p></li><li class="list-item" id="-2026317385#-v7j3hi_16"><p>Make</p></li></ul></section><section><h2 id="-2026317385#optional-tools" data-toc="optional-tools#Developer-Documentation.md-optional-tools">Optional Tools</h2><ul class="list" id="-2026317385#-v7j3hi_17" start="1"><li class="list-item" id="-2026317385#-v7j3hi_18"><p>Azd</p></li><li class="list-item" id="-2026317385#-v7j3hi_19"><p>Rider</p></li><li class="list-item" id="-2026317385#-v7j3hi_20"><p>Visual Studio Code</p></li><li class="list-item" id="-2026317385#-v7j3hi_21"><p>cppcheck</p></li></ul></section><section><h2 id="-2026317385#github-actions" data-toc="github-actions#Developer-Documentation.md-github-actions">GitHub Actions</h2><section><h3 id="-2026317385#automatic-testing" data-toc="automatic-testing#Developer-Documentation.md-automatic-testing">Automatic Testing</h3><p id="-2026317385#-v7j3hi_25">The project uses GitHub Actions to run tests on every push/pr to the master branch. These tests are mandatory and must pass before a PR can be merged. When contributing new code, also try to achieve full test coverage where possible.</p></section><section><h3 id="-2026317385#continuous-integration" data-toc="continuous-integration#Developer-Documentation.md-continuous-integration">Continuous Integration</h3><p id="-2026317385#-v7j3hi_26">The server image will be automatically built and published on push to the master branch. The documentation will be published on GitHub pages.</p><p id="-2026317385#-v7j3hi_27">In the future, there will be also plans to automatically publish all the base packages on nuget and build debian packages, including a full raspberry pi image.</p></section><section><h3 id="-2026317385#code-quality" data-toc="code-quality#Developer-Documentation.md-code-quality">Code Quality</h3><p id="-2026317385#-v7j3hi_28">The project uses GitHub Actions to run code quality checks on every push/pr to the master branch. These checks are mandatory and must pass before a PR can be merged.</p></section></section><section><h2 id="-2026317385#getting-the-code" data-toc="getting-the-code#Developer-Documentation.md-getting-the-code">Getting the Code</h2><p id="-2026317385#-v7j3hi_29">To get the code, clone the repository:</p><div class="detached code-block" id="-2026317385#-v7j3hi_30"><pre><code class="language-bash">git clone --recursive https://github.com/Team-MPM/MPM-Smart</code></pre></div></section></article></div></section><section class="topic"><div><article class="article"><h1 class="main-title" id="1003994483">Architecture</h1><section><h2 id="1003994483#introduction" data-toc="introduction#Architecture.md-introduction">Introduction</h2><p id="1003994483#z7ddmh2_5">The solution is generally organized into the following parts:</p><ul class="list" id="1003994483#z7ddmh2_6" start="1"><li class="list-item" id="1003994483#z7ddmh2_7"><p>Dotnet Solution <span class="control" id="1003994483#z7ddmh2_9">.sln</span>/<span class="control" id="1003994483#z7ddmh2_10">.slnx</span></p></li><li class="list-item" id="1003994483#z7ddmh2_8"><p>Visual Studio Code Workspace <span class="control" id="1003994483#z7ddmh2_11">.code-workspace</span> for Platform IO</p></li></ul></section><section><h2 id="1003994483#dotnet-solution-architecture" data-toc="dotnet-solution-architecture#Architecture.md-dotnet-solution-architecture">Dotnet Solution Architecture</h2><div class="container"><figure class="image-container"><img class="center image image-size" id="1003994483#z7ddmh2_12" alt="solution_architecture" title="solution_architecture" src="C:/dev/MPM-Smart/docs/Writerside/images/solution_architecture.png" width="356" height="507"><figcaption class="center-text">solution_architecture</figcaption></figure></div><section><h3 id="1003994483#frontend" data-toc="frontend#Architecture.md-frontend">Frontend</h3><p id="1003994483#z7ddmh2_22">The frontend is responsible for rendering the user interface and handling user input.</p><p id="1003994483#z7ddmh2_23">The frontend is a Blazor WebAssembly application. It is written in C# and runs in the browser. It makes use of the PWA (Progressive Web App) features to provide an offline-first experience.</p><p id="1003994483#z7ddmh2_24">We primarily make use of the following libraries:</p><ul class="list" id="1003994483#z7ddmh2_25" start="1"><li class="list-item" id="1003994483#z7ddmh2_26"><p>MudBlazor</p></li><li class="list-item" id="1003994483#z7ddmh2_27"><p>FluentValidation</p></li></ul></section><section><h3 id="1003994483#backend" data-toc="backend#Architecture.md-backend">Backend</h3><p id="1003994483#z7ddmh2_28">The backend is the primary application component running on the controller unit. It is responsible for loading all the plugins and managing the communication between them. It handles the communication between devices and acts as a bridge between the frontend and the plugins.</p></section><section><h3 id="1003994483#control-process" data-toc="control-process#Architecture.md-control-process">Control Process</h3><p id="1003994483#z7ddmh2_29">Manages the lifetime of the backend process and handles plugin updates and automatic restarts.</p></section><section><h3 id="1003994483#api-schema" data-toc="api-schema#Architecture.md-api-schema">Api Schema</h3><p id="1003994483#z7ddmh2_30">Shared class library that contains the data transfer objects (DTOs) used by the frontend and the backend.</p></section><section><h3 id="1003994483#shared" data-toc="shared#Architecture.md-shared">Shared</h3><p id="1003994483#z7ddmh2_31">Shared class library that contains the shared code between the backend and the plugin layer.</p></section><section><h3 id="1003994483#plugin-base" data-toc="plugin-base#Architecture.md-plugin-base">Plugin Base</h3><p id="1003994483#z7ddmh2_32">Base code and Interfaces for Plugins to reference.</p></section><section><h3 id="1003994483#data" data-toc="data#Architecture.md-data">Data</h3><p id="1003994483#z7ddmh2_33">Data Layer of the core Backend Application containing all EF Core Entities and the Database Context configurations.</p></section><section><h3 id="1003994483#server-serverhost" data-toc="server-serverhost#Architecture.md-server-serverhost">Server/ServerHost</h3><p id="1003994483#z7ddmh2_34">THe Plugin Server providing Plugins for download via Azure Cloud Storage. It also contains the documentation reference and a List of all Mpm-Smart devices.</p></section><section><h3 id="1003994483#tests" data-toc="tests#Architecture.md-tests">Tests</h3><p id="1003994483#z7ddmh2_35">Solution folder containing all the Unit tests separated into the different layers. There is also a <span class="control" id="1003994483#z7ddmh2_36">TestBase</span> class library that provides a unified testing experience. We primarily use XUnit for testing, FluentAssertion for assertions, and Moq for mocking.</p></section></section></article></div></section><section class="topic"><div><article class="article"><h1 class="main-title" id="1463711460">Build Instructions</h1><p id="1463711460#cqmfhx_3">To build the dotnet solution, open the solution file in the IDE of your choice or build it from the command line using the <span class="inline-code" id="1463711460#cqmfhx_9">dotnet build</span> command. Node: Even when running only a specific project, performing a full dotnet build on the solution first is recommended so that all the plugins and dependencies are built correctly the first time you run them locally.</p><p id="1463711460#cqmfhx_4">To build the device firmware, open the Platform IO workspace in Visual Studio Code and build the project using the Platform IO build command. Alternatively, you can, of course, use Platform IO on the command line as well.</p><p id="1463711460#cqmfhx_5">To build the documentation as PDF, open the JetBrains Writerside workspace and build the documentation using the included run configuration.</p><p id="1463711460#cqmfhx_6">The Makefile in the root of the repository provides shortcuts for mose these commands.</p><p id="1463711460#cqmfhx_7">To build the debian packages and controller images from source, consult the <span class="inline-code" id="1463711460#cqmfhx_10">make help</span> command. Note that this requires you to be on a linux system and have the specified dependencies installed.</p><p id="1463711460#cqmfhx_8">To run the frontend in release mode locally, perform a <span class="inline-code" id="1463711460#cqmfhx_11">dotnet publish -c Release</span> on the frontend, then navigate to the output directory based on <span class="inline-code" id="1463711460#cqmfhx_12">bin/Release/net9.0/publish/wwwroot</span> and run a local webserver to serve the files in this directory (tested using apache2 and nginx). This can easily be achieved using docker: <span class="inline-code" id="1463711460#cqmfhx_13">docker run -it --rm -p 8080:80 --name mpm-smart-app -v .:/usr/local/apache2/htdocs:ro httpd</span></p></article></div></section><section class="topic"><div><article class="article"><h1 class="main-title" id="1189023616">Plugins</h1><section><h2 id="1189023616#overview" data-toc="overview#Plugins.topic-overview">Overview</h2><p id="1189023616#-w3r2qz_5">Plugins are a way to extend the functionality of the Core Application Layer provided by the Mpm-Smart ecosystem. Plugins are usually provided by a Plugin Server or loaded from a local directory on the controller. Plugins are exclusive to the backend layer. In the UI, all plugins can implement a set of options and views providing user interactivity for plugin-specific settings and exposed data.</p></section><section><h2 id="1189023616#how-plugins-get-loaded" data-toc="how-plugins-get-loaded#Plugins.topic-how-plugins-get-loaded">How plugins get loaded</h2><p id="1189023616#-w3r2qz_6">Plugins are loaded by the Plugin Manager. The Plugin Manager is responsible for loading, unloading, and managing the lifecycle of plugins. All Plugins are loaded at startup and are initialized in no specific order. Currently, there is no way of reloading plugins while the backend service is running. In deployment, this update workflow is automated by the control process shipping with the backend.</p></section></article></div></section><section class="topic"><div><article class="article"><h1 class="main-title" id="-877782410">Creating your first Plugin</h1><section><h2 id="-877782410#introduction" data-toc="introduction#Creating-your-first-Plugin.topic-introduction">Introduction</h2><p id="-877782410#-lftja5_6">Create an empty C# dotnet 9.0 class library and adapt the <span class="filepath" id="-877782410#-lftja5_11">Plugin.csproj</span> file to the following:</p><div class="detached code-block" id="-877782410#-lftja5_7"><pre><code class="language-markup">&lt;Project Sdk=&quot;Microsoft.NET.Sdk&quot;&gt;

    &lt;PropertyGroup&gt;
        &lt;TargetFramework&gt;net9.0&lt;/TargetFramework&gt;
        &lt;ImplicitUsings&gt;enable&lt;/ImplicitUsings&gt;
        &lt;Nullable&gt;enable&lt;/Nullable&gt;
    &lt;/PropertyGroup&gt;

    &lt;PropertyGroup&gt;
        &lt;OutputPath&gt;your/plugin/output/path&lt;/OutputPath&gt;
        &lt;AppendTargetFrameworkToOutputPath&gt;false&lt;/AppendTargetFrameworkToOutputPath&gt;
    &lt;/PropertyGroup&gt;

    &lt;ItemGroup&gt;
        &lt;ProjectReference Include=&quot;..\plugin_base\PluginBase.csproj&quot; Private=&quot;False&quot;/&gt;
        &lt;ProjectReference Include=&quot;..\..\Shared\Shared.csproj&quot; Private=&quot;False&quot;/&gt;
    &lt;/ItemGroup&gt;

    &lt;ItemGroup&gt;
        &lt;FrameworkReference Include=&quot;Microsoft.AspNetCore.App&quot;/&gt;
    &lt;/ItemGroup&gt;

    &lt;ItemGroup&gt;
        &lt;None Update=&quot;plugin.json&quot;&gt;
            &lt;CopyToOutputDirectory&gt;Always&lt;/CopyToOutputDirectory&gt;
        &lt;/None&gt;
    &lt;/ItemGroup&gt;

&lt;/Project&gt;</code></pre></div><p id="-877782410#-lftja5_8">Note: In the future, the PluginBase and Shared references will be replaced by NuGet packages.</p><p id="-877782410#-lftja5_9">The <span class="filepath" id="-877782410#-lftja5_12">plugin.json</span> metadata file is a simple JSON file that contains some general information about the plugin. It should look like this:</p><div class="detached code-block" id="-877782410#-lftja5_10"><pre><code class="language-json">{
    &quot;name&quot;: &quot;Test Plugin&quot;,
    &quot;version&quot;: &quot;1.0.0&quot;,
    &quot;description&quot;: &quot;This is a test plugin&quot;,
    &quot;author&quot;: &quot;Your Name&quot;,
    &quot;dependencies&quot;: []
}</code></pre></div></section><section><h2 id="-877782410#plugin-class" data-toc="plugin-class#Creating-your-first-Plugin.topic-plugin-class">Plugin Class</h2><p id="-877782410#-lftja5_13">Create a new class that implements the <span class="inline-code" id="-877782410#-lftja5_15">IPlugin</span> interface. Alternatively, one can also make use of the <span class="inline-code" id="-877782410#-lftja5_16">PluginBase</span> class that provides some default implementations.</p><div class="detached code-block" id="-877782410#-lftja5_14"><pre><code class="language-csharp">public class TestPluginClass : PluginBase&lt;TestPluginClass&gt;
{
    protected override void Initialize()
    {
        
    }

    protected override void BuildEndpoints(IEndpointRouteBuilder routeBuilder)
    {
    
    }

    protected override void ConfigureServices(IServiceCollection services)
    {
    
    }

    protected override void SystemStart()
    {
        
    }
}</code></pre></div></section><section><h2 id="-877782410#additional-considerations" data-toc="additional-considerations#Creating-your-first-Plugin.topic-additional-considerations">Additional Considerations</h2><ul class="list" id="-877782410#-lftja5_17" start="1"><li class="list-item" id="-877782410#-lftja5_18"><p>Make sure to include all static assets in the output folder of the plugin.</p></li><li class="list-item" id="-877782410#-lftja5_19"><p>Make sure there are now overlapping .dll file dependencies with the backend application for shared types.</p></li><li class="list-item" id="-877782410#-lftja5_20"><p>Make sure to include all necessary files in the .csproj file.</p></li><li class="list-item" id="-877782410#-lftja5_21"><p>Make sure to include all necessary dependencies in the <span class="inline-code" id="-877782410#-lftja5_22">plugin.json</span> file.</p></li></ul></section></article></div></section><section class="topic"><div><article class="article"><h1 class="main-title" id="1005571011">Developing plugins locally</h1><section><h2 id="1005571011#building_the_plugin" data-toc="building_the_plugin#Developing-plugins-locally.topic-building_the_plugin">Building the plugin</h2><p id="1005571011#jjqb3k_3">To build a plugin, you need to have the following prerequisites:</p><ul class="list" id="1005571011#jjqb3k_4" start="1"><li class="list-item" id="1005571011#jjqb3k_6"><p>.NET 9 SDK</p></li><li class="list-item" id="1005571011#jjqb3k_7"><p>A source build of the Mpm-Smart Controller</p></li><li class="list-item" id="1005571011#jjqb3k_8"><p>The current version of the <span class="inline-code" id="1005571011#jjqb3k_9">PluginBase.dll</span> and <span class="inline-code" id="1005571011#jjqb3k_10">Shared.dll</span> libraries</p></li></ul><p id="1005571011#jjqb3k_5">Put your plugin dll output in the plugin directory of the controller application. Hot reloads aren't supported, so you have to restart the backend every time you rebuild the plugin.</p></section></article></div></section><section class="topic"><div><article class="article"><h1 class="main-title" id="-2092318995">Managing Plugin Services</h1><section><h2 id="-2092318995#introduction" data-toc="introduction#Managing-Plugin-Services.topic-introduction">Introduction</h2><p id="-2092318995#-c8myee_6">All Services are divided into two parts:</p><ul class="list" id="-2092318995#-c8myee_7" start="1"><li class="list-item" id="-2092318995#-c8myee_8"><p><span class="control" id="-2092318995#-c8myee_10">Core Services</span>: These are provided by the backend out of the box and can't be modified from the plugin stage</p></li><li class="list-item" id="-2092318995#-c8myee_9"><p><span class="control" id="-2092318995#-c8myee_11">Plugin Services</span>: These are provided by the plugins and can be modified from the plugin. They also offer a way for plugin to communicate with each other.</p></li></ul></section><section><h2 id="-2092318995#logging" data-toc="logging#Managing-Plugin-Services.topic-logging">Logging</h2><p id="-2092318995#-c8myee_12">The core application and plugin modules use two separate loggers. For development purposes, all logs are uniformly output to the same console. On disk, you will find a log directory with the following files:</p><ul class="list" id="-2092318995#-c8myee_13" start="1"><li class="list-item" id="-2092318995#-c8myee_19"><p><span class="filepath" id="-2092318995#-c8myee_23">backend.log</span>: Contains all logs from the core application layer</p></li><li class="list-item" id="-2092318995#-c8myee_20"><p><span class="filepath" id="-2092318995#-c8myee_24">error.log</span>: Contains all errors from the core application layer</p></li><li class="list-item" id="-2092318995#-c8myee_21"><p><span class="filepath" id="-2092318995#-c8myee_25">plugin.log</span>: Contains all logs from the plugin modules</p></li><li class="list-item" id="-2092318995#-c8myee_22"><p><span class="filepath" id="-2092318995#-c8myee_26">plugin-error.log</span>: Contains all errors from the plugin modules</p></li></ul><p id="-2092318995#-c8myee_14">These log files use a plain text in UTF-8 format and use the following layout:  <span class="inline-code" id="-2092318995#-c8myee_28">                 Date Time Timezone [LEVEL] Message             </span> For example:  <span class="inline-code" id="-2092318995#-c8myee_31">                 2024-11-04 07:55:17.633 +01:00 [INF] Starting Mpm-Smart             </span></p><p id="-2092318995#-c8myee_15">The logging system uses the default Microsoft.Extensions.Logging base library together with serilog for the backend and plugin modules. To use the logger, inject the <span class="inline-code" id="-2092318995#-c8myee_32">ILogger&lt;T&gt;</span> interface into your service.</p><p id="-2092318995#-c8myee_16">Since there logs can also be exported as structured logs, make use of the message templating instead of using string interpolation and pass down the full exception instance where applicable.</p></section><section><h2 id="-2092318995#database-management" data-toc="database-management#Managing-Plugin-Services.topic-database-management">Database Management</h2><p id="-2092318995#-c8myee_37">The core application layer uses Entity Framework Core to manage its databases. You can also use your own custom database models in your plugins, but using Entity Framework Core with SQLite is the only first party supported option. When registering a Database Context in your plugin service collection, its provided migrations will automatically be picked up by the <span class="inline-code" id="-2092318995#-c8myee_41">DbInitializer</span> and applied to the database on startup. If the database is not present, it will be created.</p><blockquote class="prompt flex bordered-element-rounded tip detached">
  <svg xmlns="http://www.w3.org/2000/svg" class="prompt-icon">
    <path d="M12.946 3.552L21.52 18.4c.424.735.33 1.6-.519 1.6H3.855c-.85 0-1.817-.865-1.392-1.6l8.573-14.848a1.103 1.103 0 0 1 1.91 0zm.545 12.948a1.5 1.5 0 1 0-1.5 1.5 1.5 1.5 0 0 0 1.5-1.5zM13 8h-2v5h2z"></path>
  </svg>
  <div class="prompt-content prompt-content-p">
    <div class="prompt-title">Migrations</div>
<p id="-2092318995#-c8myee_42">When using migrations, make sure to specify the correct migration assembly in a way that is independent of the hosting environment or the startup project.</p>  </div>
</blockquote>
<blockquote class="prompt flex bordered-element-rounded tip detached">
  <svg xmlns="http://www.w3.org/2000/svg" class="prompt-icon">
    <path d="M12.946 3.552L21.52 18.4c.424.735.33 1.6-.519 1.6H3.855c-.85 0-1.817-.865-1.392-1.6l8.573-14.848a1.103 1.103 0 0 1 1.91 0zm.545 12.948a1.5 1.5 0 1 0-1.5 1.5 1.5 1.5 0 0 0 1.5-1.5zM13 8h-2v5h2z"></path>
  </svg>
  <div class="prompt-content prompt-content-p">
    <div class="prompt-title">Seeding</div>
<p id="-2092318995#-c8myee_43">A system to automatically seed plugin databases is not yet implemented. See Project plan for open issue.</p>  </div>
</blockquote>
<p id="-2092318995#-c8myee_40">Plugins can also access the <span class="inline-code" id="-2092318995#-c8myee_44">SystemDbContext</span> by using the application service provider provided on initialization of the plugin instance.</p></section></article></div></section></div></body></html>